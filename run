#!/bin/sh

set -e

trap clean 0 1 2 3 6

clean() {
  rm -rf Lexer.hs Parser.hs *.{hi,o}
}

alex Lexer.x
happy --info Parser.y

ghc Main.hs -o a.out
time ./a.out <input.txt
exit

case "$1" in
  *.hs) ghci -XOverloadedStrings "$1";;
  *.x)  ghci -XOverloadedStrings 'Lexer.hs';;
  *.y)  ghci -XOverloadedStrings 'Parser.hs';;
  *)    echo "cannot run '$1'";;
esac
