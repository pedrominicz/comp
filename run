#!/usr/bin/env bash

set -e

make

assert() {
  expected="$1"
  input="$2"

  ./m "$input" >tmp.s
  gcc -static -o tmp tmp.s

  actual=0; ./tmp || actual="$?"

  if [ "$actual" -ne "$expected" ]; then
    echo "$input" >&2
    exit 1
  fi
}

assert 0 'fn main() { return 0; }'

echo 'OK'
