#!/bin/sh

set -e

trap clean 0 1 2 3 6

clean() {
  rm -rf Lex.hs Parse.hs *.{hi,o}
}

alex Lexer.x
happy Parser.y

ghc Main.hs -o a.out
time ./a.out
exit

case "$1" in
  *.hs) ghci -XOverloadedStrings "$1";;
  *.x)  ghci -XOverloadedStrings 'Lexer.hs';;
  *.y)  ghci -XOverloadedStrings 'Parser.hs';;
  *)    echo "cannot run '$1'";;
esac
