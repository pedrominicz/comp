#!/bin/sh

set -e

ocamlc qcc.ml
rm -f qcc.cmi qcc.cmo

./a.out test_patchlval.c
chmod +x out
./out

tail -c +241 out |ndisasm -b64 -

exit

case "$1" in
  *.c)    ./a.out "$1" && chmod +x out && ./out;;
  *.hs)   exec ghci "$1";;
  *.ml)   exec rlwrap ocaml;;
  *.py)   exec python mcc.py </dev/null;;
  *)      echo "cannot run '$1'";;
esac
